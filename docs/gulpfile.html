<!DOCTYPE html>

<html>
<head>
  <title>gulpfile.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h1 id="gulpfile-js">gulpfile.js</h1>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h3 id="requires">Requires</h3>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>This is where the build dependencies get loaded</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span>     parseArgs   = <span class="hljs-built_in">require</span>(<span class="hljs-string">'minimist'</span>)
    ,   gulp        = <span class="hljs-built_in">require</span>(<span class="hljs-string">'gulp'</span>)
    ,   jade        = <span class="hljs-built_in">require</span>(<span class="hljs-string">'gulp-jade'</span>)
    ,   sass        = <span class="hljs-built_in">require</span>(<span class="hljs-string">'gulp-sass'</span>)
    ,   run         = <span class="hljs-built_in">require</span>(<span class="hljs-string">'gulp-run'</span>)
    ,   util        = <span class="hljs-built_in">require</span>(<span class="hljs-string">'gulp-util'</span>)
    ,   debug       = <span class="hljs-built_in">require</span>(<span class="hljs-string">'gulp-debug'</span>)
    ,   jshint      = <span class="hljs-built_in">require</span>(<span class="hljs-string">'gulp-jshint'</span>)
    ,   gls         = <span class="hljs-built_in">require</span>(<span class="hljs-string">'gulp-live-server'</span>)
    ,   stylish     = <span class="hljs-built_in">require</span>(<span class="hljs-string">'jshint-stylish'</span>)
    ,   nodeUtil    = <span class="hljs-built_in">require</span>(<span class="hljs-string">'util'</span>)
    ,   through2    = <span class="hljs-built_in">require</span>(<span class="hljs-string">'through2'</span>)
    ,   npm         = <span class="hljs-built_in">require</span>(<span class="hljs-string">'npm'</span>)
    ,   _           = <span class="hljs-built_in">require</span>(<span class="hljs-string">'lodash'</span>)
    ,   Q           = <span class="hljs-built_in">require</span>(<span class="hljs-string">'q'</span>)
    ,   mocha       = <span class="hljs-built_in">require</span>(<span class="hljs-string">'gulp-mocha'</span>)
    ,   del         = <span class="hljs-built_in">require</span>(<span class="hljs-string">'del'</span>)
    ,   vinylPaths  = <span class="hljs-built_in">require</span>(<span class="hljs-string">'vinyl-paths'</span>)
    ,   karmaServer = <span class="hljs-built_in">require</span>(<span class="hljs-string">'karma'</span>).Server
    ,   fs          = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>)
    ,   browserify  = <span class="hljs-built_in">require</span>(<span class="hljs-string">'browserify'</span>)
    ,   source      = <span class="hljs-built_in">require</span>(<span class="hljs-string">'vinyl-source-stream'</span>)
    ,   buffer      = <span class="hljs-built_in">require</span>(<span class="hljs-string">'vinyl-buffer'</span>)
    ,   uglify      = <span class="hljs-built_in">require</span>(<span class="hljs-string">'gulp-uglify'</span>)
    ,   sourcemaps  = <span class="hljs-built_in">require</span>(<span class="hljs-string">'gulp-sourcemaps'</span>)
    ,   es          = <span class="hljs-built_in">require</span>(<span class="hljs-string">'event-stream'</span>)
    ,   docco       = <span class="hljs-built_in">require</span>(<span class="hljs-string">'docco'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Load the package.json file, which is used in building.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> projectPackageJson = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./package.json'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <h3 id="build-configuration">Build Configuration</h3>

            </div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>This is where we store all of the build configuration information,
including paths to files, destination directories, and jade locals data.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> buildConfig = {</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p><strong>Front End configuration block</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  frontend: {</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p><strong>index.jade configuration</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    index: {
      src: <span class="hljs-string">'source/frontend/html/index.jade'</span>,
      dest: <span class="hljs-string">'build/public'</span>,
      locals: {
        title: <span class="hljs-string">"HTML5 Games!"</span>
      }
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p><strong>game jade files configuration</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    games: {
      src: <span class="hljs-string">'source/frontend/html/games/**/*.jade'</span>,
      dest: <span class="hljs-string">'build/public/games'</span>,
      locals: {
        bubbleShooter: {
          title: <span class="hljs-string">"Bubble Shooter!"</span>
        }
      }
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p><strong>javascript configuration</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    js: {</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p><strong>front end code</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      project: {
        src: <span class="hljs-string">'source/frontend/js/**/*.js'</span>,
        dest: <span class="hljs-string">'build/public/js'</span>
      },</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p><strong>front end tests</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      test: {
        src: <span class="hljs-string">'test/frontend/**/*.js'</span>,
        dest: <span class="hljs-literal">null</span>
      },</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p><strong><a href="https://github.com/substack/node-browserify">Browserify</a> Bundles configuration</strong></p>
<p>These <em>bundles</em> options objects are formatted for <a href="#buildBrowserifyBundle">buildBrowserifyBundle</a>
and used by <a href="#build-frontend-js-bundles">build-frontend-js-bundles</a>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      bundles: {</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p><strong>index.js bundle</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        index: {
          entries: <span class="hljs-string">'source/frontend/js/index.js'</span>,
          <span class="hljs-built_in">require</span>: [],
          external: [<span class="hljs-string">'jquery'</span>, <span class="hljs-string">'q'</span>, <span class="hljs-string">'lodash'</span>],
          output: <span class="hljs-string">'index.js'</span>,
          dest: <span class="hljs-string">'build/public/js'</span>
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p><strong>engine.js bundle</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        engine: {
          entries: <span class="hljs-string">'source/frontend/js/engine/engine.js'</span>,
          <span class="hljs-built_in">require</span>: [
            {
              file: <span class="hljs-string">'./source/frontend/js/engine/vector2d.js'</span>,
              expose: <span class="hljs-string">'vector2d'</span>
            }
          ],
          external: [],
          output: <span class="hljs-string">'engine.js'</span>,
          dest: <span class="hljs-string">'build/public/js/engine'</span>
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p><strong>bubble-shooter.js bundle</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        bubbleShooter: {
          entries: <span class="hljs-string">'source/frontend/js/games/bubble-shooter.js'</span>,
          <span class="hljs-built_in">require</span>: [],
          external: [<span class="hljs-string">'jquery'</span>, <span class="hljs-string">'q'</span>, <span class="hljs-string">'lodash'</span>],
          output: <span class="hljs-string">'bubble-shooter.js'</span>,
          dest: <span class="hljs-string">'build/public/js/games'</span>
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p><strong>vendor.js bundle</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        vendor: {
          entries: <span class="hljs-string">'source/frontend/vendor/js/development/vendor.js'</span>,
          <span class="hljs-built_in">require</span>: [<span class="hljs-string">'jquery'</span>, <span class="hljs-string">'q'</span>, <span class="hljs-string">'lodash'</span>],
          external: [],
          output: <span class="hljs-string">'vendor.js'</span>,
          dest: <span class="hljs-string">'build/public/vendor/js'</span>
        }
      }
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p><strong>css build configuration</strong></p>
<p><em>we currently build scss</em></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    css: {
      project: {
        src: <span class="hljs-string">'source/frontend/css/**/*.scss'</span>,
        dest: <span class="hljs-string">'build/public/css'</span>
      },
      vendor: {
        src: <span class="hljs-string">'source/frontend/vendor/css/**/*.scss'</span>
      }
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p><strong>image build configuration</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    img: {
      src: <span class="hljs-string">'source/frontend/img/**/*'</span>,
      dest: <span class="hljs-string">'build/public/img'</span>
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p><strong>frontend test configuration</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    test: {
      karmaConfigPath: <span class="hljs-string">'/test/karma.conf.js'</span>,
      all: <span class="hljs-string">'test/**/*'</span>
    },
    all: <span class="hljs-string">"source/frontend/**/*"</span>
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p><strong>Server Configuration Block</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  server: {
    js: {
      src: <span class="hljs-string">'source/server/**/*.js'</span>
    },
    test: {
      src: <span class="hljs-string">'test/server/**/*.js'</span>
    },
    all: <span class="hljs-string">'source/server/**/*'</span>
  },
  allSource: <span class="hljs-string">"source/**/*"</span>,
  allTest: <span class="hljs-string">"test/**/*"</span>
};</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <h3 id="helper-functions">Helper Functions</h3>

            </div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p><span id="clean"><span>
<strong>clean</strong> </p>
<p>Deletes a folder (path) and its contents.
Used by the <a href="#clean-server">clean-server</a> and <a href="#clean-frontend">clean-frontend</a> gulp tasks.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">clean</span>(<span class="hljs-params">path</span>) </span>{
  <span class="hljs-keyword">return</span> gulp.src(path, {read: <span class="hljs-literal">false</span>})
    .pipe(vinylPaths(del));
}</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p><span id="buildBrowserifyBundle"></span>
<strong>buildBrowserifyBundle</strong> </p>
<p>Builds a <a href="https://github.com/substack/node-browserify">Browserify</a> bundle based on <code>bundleOptions</code>.
Used by <a href="#build-frontend-js-bundles">build-frontend-js-bundles</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">buildBrowserifyBundle</span>(<span class="hljs-params">bundleOptions</span>) </span>{
    <span class="hljs-keyword">var</span> b = browserify({
      entries: bundleOptions.entries,
      debug: <span class="hljs-literal">true</span>
    });

    b.require(bundleOptions.require);
    b.external(bundleOptions.external);

    <span class="hljs-keyword">return</span> b.bundle()
      .pipe(source(bundleOptions.output))
      .pipe(buffer())
      .pipe(sourcemaps.init({loadMaps: <span class="hljs-literal">true</span>}))
      .pipe(sourcemaps.write(<span class="hljs-string">'./'</span>))
      .pipe(gulp.dest(bundleOptions.dest));
}</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p><span id="buildServer"><span>
<strong>buildServer</strong> </p>
<p>Copies the http server files into the build directory.</p>
<p>Used by the <a href="#clean-server">clean-server</a> and <a href="#clean-frontend">clean-frontend</a> gulp tasks.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">buildServer</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> gulp.src(buildConfig.server.all)
    .pipe(gulp.dest(<span class="hljs-string">'build'</span>));
}</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p><span id="generateDocumentation"><span>
<strong>generateDocumentation</strong> </p>
<p>Generates documentation from source using <a href="http://jashkenas.github.io/docco/">Docco</a>.</p>
<p>Used by the <a href="#gendoc">gendoc</a> task.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">generateDocumentation</span>(<span class="hljs-params">inputPath, outputPath</span>) </span>{
  
  <span class="hljs-keyword">var</span> <span class="hljs-built_in">arguments</span> = [<span class="hljs-string">'docco'</span>, <span class="hljs-string">'-o'</span>, outputPath, inputPath];
  docco.run(<span class="hljs-built_in">arguments</span>);
}</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <h2 id="gulp-tasks">Gulp Tasks</h2>

            </div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <h3 id="documentation-tasks">Documentation Tasks</h3>

            </div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p><span id="gendoc"><span>
<strong>gendoc</strong> </p>
<p>Generates documentation from source using <a href="http://jashkenas.github.io/docco/">Docco</a>.</p>
<p>Uses the <a href="#generateDocumentation">generateDocumentation</a> helper function.</p>
<p>To run this task, type <code>gulp gendoc</code> on the command line.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>gulp.task(<span class="hljs-string">'gendoc'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  generateDocumentation(<span class="hljs-string">'gulpfile.js'</span>, <span class="hljs-string">'docs'</span>);
});</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <h3 id="server-tasks">Server Tasks</h3>

            </div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p><span id="lint-server"></span>
<strong>lint-server</strong> </p>
<p>This task lints server JavaScript code.</p>
<p>To run this task, type <code>gulp lint-server</code> on the command line.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>gulp.task(<span class="hljs-string">'lint-server'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  
  <span class="hljs-keyword">return</span> gulp.src(buildConfig.server.js.src)
    .pipe(jshint({ 
      laxcomma: <span class="hljs-literal">true</span>
    }))
    .pipe(jshint.reporter(stylish))
    pipe(jshint.reporter(<span class="hljs-string">'fail'</span>));

});</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p><span id='test-server'></span>
<strong>test-server</strong></p>
<p>This task runs tests against the project’s server code.</p>
<p>To run this task, type <code>gulp test-server</code> on the command line.</p>
<p>This task depends on <a href="#lint-server">lint-server</a>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>gulp.task(<span class="hljs-string">'test-server'</span>, [<span class="hljs-string">'lint-server'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">done</span>) </span>{
  <span class="hljs-keyword">return</span> gulp.src(buildConfig.server.test.src, {read: <span class="hljs-literal">false</span>})
          .pipe(mocha({reporter: <span class="hljs-string">'spec'</span>}));
});</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p><span id='clean-server'></span>
<strong>clean-server</strong></p>
<p>This task deletes the contents of the build folder.</p>
<p>To run this task, type <code>gulp clean-server</code> on the command line.</p>
<p>Uses the <a href="#clean">clean</a> helper function.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>gulp.task(<span class="hljs-string">'clean-server'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> clean(<span class="hljs-string">'build/*'</span>);
})</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p><span id='build-server'></span>
<strong>build-server</strong></p>
<p>This task copies the http server files into the build directory.</p>
<p>To run this task, type <code>gulp build-server</code> on the command line.</p>
<p>Uses the <a href="#buildServer">buildServer</a> helper function.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>gulp.task(<span class="hljs-string">'build-server'</span>, [<span class="hljs-string">'clean-server'</span>, <span class="hljs-string">'test-server'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> buildServer();
});</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <h3 id="frontend-tasks">Frontend Tasks</h3>

            </div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p><span id='clean-frontend'></span>
<strong>clean-frontend</strong></p>
<p>This task deletes frontend build artifacts from the build folder.</p>
<p>To run this task, type <code>gulp clean-frontend</code> on the command line.</p>
<p>Uses the <a href="#clean">clean</a> helper function.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>gulp.task(<span class="hljs-string">'clean-frontend'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> clean(<span class="hljs-string">'build/public/*'</span>);
});</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p><span id='lint-frontend'></span>
<strong>lint-frontend</strong></p>
<p>This task lints frontend JavaScript code.</p>
<p>To run this task, type <code>gulp lint-frontend</code> on the command line.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>gulp.task(<span class="hljs-string">'lint-frontend'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  
  <span class="hljs-keyword">return</span> gulp.src(buildConfig.frontend.js.project.src)
    .pipe(jshint({ 
      browser: <span class="hljs-literal">true</span>,
      laxcomma: <span class="hljs-literal">true</span>
    }))
    .pipe(jshint.reporter(stylish))
    pipe(jshint.reporter(<span class="hljs-string">'fail'</span>));

});</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p><span id='test-frontend'></span>
<strong>test-frontend</strong></p>
<p>This task tests frontend JavaScript code.</p>
<p>To run this task, type <code>gulp test-frontend</code> on the command line.</p>
<p>Depends on <a href="#lint-frontend">lint-frontend</a>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>gulp.task(<span class="hljs-string">'test-frontend'</span>, [<span class="hljs-string">'lint-frontend'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">done</span>) </span>{
  <span class="hljs-keyword">new</span> karmaServer({
    configFile: __dirname + buildConfig.frontend.test.karmaConfigPath,
    singleRun: <span class="hljs-literal">true</span>
  }, done).start();
});</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p><span id='build-frontend-copy-img'></span>
<strong>build-frontend-copy-img</strong></p>
<p>This task copies image assets into the build folder.</p>
<p>To run this task, type <code>gulp build-frontend-copy-img</code> on the command line.</p>
<p>Depends on <a href="#clean-frontend">clean-frontend</a>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>gulp.task(<span class="hljs-string">'build-frontend-copy-img'</span>, [<span class="hljs-string">'clean-frontend'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> gulp.src(buildConfig.frontend.img.src)
    .pipe(gulp.dest(buildConfig.frontend.img.dest));
});</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p><span id='build-frontend-css'></span>
<strong>build-frontend-css</strong></p>
<p>This task builds css from scss source.</p>
<p>To run this task, type <code>gulp build-frontend-css</code> on the command line.</p>
<p>Depends on <a href="#clean-frontend">clean-frontend</a>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>gulp.task(<span class="hljs-string">'build-frontend-css'</span>, [<span class="hljs-string">'clean-frontend'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

  util.log(buildConfig.frontend.css.project.src, buildConfig.frontend.css.vendor.src);
  util.log(buildConfig.frontend.css.project.dest);
  <span class="hljs-keyword">return</span> gulp.src([buildConfig.frontend.css.vendor.src, buildConfig.frontend.css.project.src])
    .pipe(sass())
    .pipe(gulp.dest(buildConfig.frontend.css.project.dest));

});</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p><span id='build-frontend-index-html'></span>
<strong>build-frontend-index-html</strong></p>
<p>This task builds index.html from index.jade.  This file is the front page
of our games site.</p>
<p>To run this task, type <code>gulp build-frontend-index-html</code> on the command line.</p>
<p>Depends on <a href="#clean-frontend">clean-frontend</a>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>gulp.task(<span class="hljs-string">'build-frontend-index-html'</span>, [<span class="hljs-string">'clean-frontend'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  
  <span class="hljs-keyword">return</span> gulp.src(buildConfig.frontend.index.src)
    .pipe(jade({
      pretty: <span class="hljs-literal">true</span>,
      locals: buildConfig.frontend.index.locals
    }))
    .pipe(gulp.dest(buildConfig.frontend.index.dest));

});</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p><span id='build-frontend-games-html'></span>
<strong>build-frontend-games-html</strong></p>
<p>This task builds html pages for our games from their jade source.</p>
<p>To run this task, type <code>gulp build-frontend-games-html</code> on the command line.</p>
<p>Depends on <a href="#clean-frontend">clean-frontend</a>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>gulp.task(<span class="hljs-string">'build-frontend-games-html'</span>, [<span class="hljs-string">'clean-frontend'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  
  <span class="hljs-keyword">return</span> gulp.src(buildConfig.frontend.games.src)
    .pipe(jade({
      pretty: <span class="hljs-literal">true</span>,
      locals: buildConfig.frontend.games.locals
    }))
    .pipe(gulp.dest(buildConfig.frontend.games.dest));

});</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p><span id="build-frontend-js-bundles"></span>
<strong>build-frontend-js-bundles</strong></p>
<p>This task builds all of our <a href="https://github.com/substack/node-browserify">Browserify</a>
bundles.</p>
<p>To run this task, type <code>gulp build-frontend-js-bundles</code> on the command line.</p>
<p>It uses the <a href="#buildBrowserifyBundle">buildBrowserifyBundle</a> helper function to accomplish this.</p>
<p>Depends on <a href="#clean-frontend">clean-frontend</a> and <a href="#test-frontend">test-frontend</a> tasks.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>gulp.task(<span class="hljs-string">'build-frontend-js-bundles'</span>, [<span class="hljs-string">'test-frontend'</span>, <span class="hljs-string">'clean-frontend'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  
  <span class="hljs-keyword">var</span> tasks = _.map(buildConfig.frontend.js.bundles, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">bundleOptions</span>) </span>{
    <span class="hljs-keyword">return</span> buildBrowserifyBundle(bundleOptions);
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>create a merged stream</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">return</span> es.merge.apply(<span class="hljs-literal">null</span>, tasks);
});</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p><span id="build-frontend"></span>
<strong>build-frontend</strong></p>
<p>This task runs all frontend build tasks.</p>
<p>To run this task, type <code>gulp build-frontend</code> on the command line.</p>
<p>Depends on the following tasks:</p>
<ul>
<li><a href="#build-frontend-index-html">build-frontend-index-html</a></li>
<li><a href="#build-frontend-games-html">build-frontend-games-html</a></li>
<li><a href="#build-frontend-js-bundles">build-frontend-js-bundles</a></li>
<li><a href="#build-frontend-css">build-frontend-css</a></li>
<li><a href="#build-frontend-copy-img">build-frontend-copy-img</a></li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>gulp.task(<span class="hljs-string">'build-frontend'</span>, [<span class="hljs-string">'build-frontend-index-html'</span>, <span class="hljs-string">'build-frontend-games-html'</span>, <span class="hljs-string">'build-frontend-js-bundles'</span>, <span class="hljs-string">'build-frontend-css'</span>, <span class="hljs-string">'build-frontend-copy-img'</span>]);</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p><span id="build-all"></span>
<strong>build-all</strong></p>
<p>This task runs all server and frontend build tasks.</p>
<p>To run this task, type <code>gulp build-all</code> on the command line.</p>
<p>Depends on the following tasks:</p>
<ul>
<li><a href="#build-frontend">build-frontend</a></li>
<li><a href="#build-server">build-server</a></li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>gulp.task(<span class="hljs-string">'build-all'</span>, [<span class="hljs-string">'build-frontend'</span>, <span class="hljs-string">'build-server'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">done</span>) </span>{ done(); });</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p><span id="install"></span>
<strong>install</strong></p>
<p>This task installs node_modules in the build folder for deployment.</p>
<p>To run this task, type <code>gulp install</code> on the command line.</p>
<p>Depends on the following tasks:</p>
<ul>
<li><a href="#build-all">build-all</a></li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>gulp.task(<span class="hljs-string">'install'</span>, [<span class="hljs-string">'build-all'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">cb</span>) </span>{
  <span class="hljs-keyword">var</span> buildPackageJsonWithPrefix = {
    prefix: <span class="hljs-string">'build'</span>
  };

  _.merge(buildPackageJsonWithPrefix, projectPackageJson);

  npm.load(buildPackageJsonWithPrefix, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    npm.commands.install(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">error</span>) </span>{
      <span class="hljs-keyword">if</span> (error) {
        cb(error);
      }
      <span class="hljs-keyword">else</span> {
        cb();
      }
    });
  });
});</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p><span id="serve"></span>
<strong>serve</strong></p>
<p>This tasks runs the express server in our build directory, and
then continuously rebuilds our frontend code as we make modifications.</p>
<p><a href="https://github.com/gimm/gulp-live-server">Gulp Live Server</a>
starts our express server and also starts a websocket server to
provide automatic <a href="https://github.com/livereload/LiveReload">LiveReload</a> 
broswer refreshes as we modify our code.</p>
<p>To run this task, type <code>gulp serve</code> on the command line.</p>
<p>Depends on the following tasks:</p>
<ul>
<li><a href="#build-all">build-all</a></li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>gulp.task(<span class="hljs-string">'serve'</span>, [<span class="hljs-string">'build-all'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>run the server</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> server = gls.new(<span class="hljs-string">'build/app.js'</span>, 
    {
      env: {
        NODE_ENV: <span class="hljs-string">'development'</span>,
        DEBUG: <span class="hljs-string">'html-games:*, express:*'</span>
      }
  });

  server.start(<span class="hljs-string">'build/bin/www'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>notify the server of file changes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  gulp.watch([<span class="hljs-string">'build/public/**/*'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">file</span>) </span>{
    server.notify.apply(server, [file]);
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>watch the frontend source and tests, rebuild as they are modified.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  gulp.watch([buildConfig.frontend.all, buildConfig.frontend.test.all], [<span class="hljs-string">'build-frontend'</span>]);
});</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p><span id="default"></span>
<strong>default</strong></p>
<p>This is the default gulp task.  All it does is run <a href="#serve">serve</a>.</p>
<p>To run this task, type <code>gulp</code> on the command line.</p>
<p>Depends on the following tasks:</p>
<ul>
<li><a href="#serve">serve</a></li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>gulp.task(<span class="hljs-string">'default'</span>, [<span class="hljs-string">'serve'</span>]);</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
